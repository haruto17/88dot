<!DOCTYPE html>
<html>
	<head>
		<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.2/dist/cdn.min.js"></script>
	<style>
		body {
			background-color: #333333;
		}
	</style>
	</head>
	<body>
    	<h1 x-data="{ message: 'I ❤️ Alpine' }" x-text="message"></h1>
		<canvas id="canvas"></canvas>
	</body>
	<script>
		var canvas;
		var ctx;

		var cell_width = 64;
		var cell_height = 64;

		var x = 0;
		var y = 0;

		var canvas_magnification = 10;

		function initCanvas() {
			appendGrid();
		}

		function appendGrid() {
			ctx.strokeStyle = "#1e90ff";
			ctx.lineWidth = 2;

			ctx.beginPath();
  			for (var i = 0; i < cell_width+1; i++) {
    			ctx.moveTo((i*canvas_magnification),0);
    			ctx.lineTo((i*canvas_magnification),canvas.height);
  			}

  			for (var i = 0; i < cell_height+1; i++) {
    			ctx.moveTo(0,(i*canvas_magnification));
    			ctx.lineTo(canvas.height,(i*canvas_magnification));
  			}
			ctx.stroke();
		}

		function onMouseDown(x, y) {
			//var rect = e.target.getBoundingClientRect();
			//var mousex = e.clientX - rect.left;
			//var mousey = e.clientY - rect.top;

			var col = x;
			var row = y;

			ctx.fillStyle = "rgb(200, 10, 10)";
			ctx.fillRect(col * canvas_magnification, row * canvas_magnification, canvas_magnification, canvas_magnification);

			appendGrid();
		}

		function onKeyDown(e) {
			console.log(x, y);
			if (e.key == "w") {
				if (y > 0) {
					y -= 1;
				}
			} else if (e.key == "a") {
				if (x > 0) {
					x -= 1;
				}
			} else if (e.key == "s") {
				if (y < 64) {
					y += 1;
				}
			} else if (e.key == "d") {
				if (x < 64) {
					x += 1;
				}
			} else if (e.key == " ") {
				onMouseDown(x, y);
			}
		}

		window.onload = (event) => {
			canvas = document.getElementById("canvas");
			
			canvas.width = cell_width * canvas_magnification;
			canvas.height = cell_height * canvas_magnification;

			ctx = canvas.getContext("2d");

			document.addEventListener("keydown", e => {
				onKeyDown(e);
			});

			initCanvas();
		}

	</script>
</html>
