<!DOCTYPE html>
<html>
	<head>
		<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.2/dist/cdn.min.js"></script>
	<style>
		body {
			background-color: #333333;
		}
	</style>
	</head>
	<body>
    	<h1 x-data="{ message: 'I ❤️ Alpine' }" x-text="message"></h1>
		<div style="position: relative;">
			<canvas id="canvas"></canvas>
			<canvas id="grid" style="position: absolute; top: 0px; left: 0px; visibility: visible;"></canvas>
		</div>
	</body>
	<script>
		var canvas;
		var canvas_ctx;

		var grid;
		var grid_ctx;

		var cell_width = 64;
		var cell_height = 64;

		var x = 0;
		var y = 0;

		var canvas_magnification = 10;

		function initCanvas() {
			appendGrid();
		}

		function appendGrid() {
			grid_ctx.strokeStyle = "#1e90ff";
			grid_ctx.lineWidth = 2;

			grid_ctx.beginPath();
  			for (var i = 0; i < cell_width+1; i++) {
    			grid_ctx.moveTo((i*canvas_magnification),0);
    			grid_ctx.lineTo((i*canvas_magnification),canvas.height);
  			}

  			for (var i = 0; i < cell_height+1; i++) {
    			grid_ctx.moveTo(0,(i*canvas_magnification));
    			grid_ctx.lineTo(canvas.height,(i*canvas_magnification));
  			}
			grid_ctx.stroke();
		}

		function paintColor(x, y) {
			var col = x;
			var row = y;

			canvas_ctx.fillStyle = "rgb(200, 10, 10)";
			canvas_ctx.fillRect(col * canvas_magnification, row * canvas_magnification, canvas_magnification, canvas_magnification);

			appendGrid();
		}

		function onKeyDown(e) {
			console.log(x, y);
			if (e.key == "w") {
				if (y > 0) {
					y -= 1;
				}
			} else if (e.key == "a") {
				if (x > 0) {
					x -= 1;
				}
			} else if (e.key == "s") {
				if (y < 64) {
					y += 1;
				}
			} else if (e.key == "d") {
				if (x < 64) {
					x += 1;
				}
			} else if (e.key == " ") {
				paintColor(x, y);
			} else if (e.key == "t") {
				exportCanvas();
			}
		}

		function exportCanvas() {
			canvas = document.getElementById("canvas");
			const a = document.createElement("a");
			a.href = canvas.toDataURL("image/png", 1.0);
			a.download = "88.png";
			a.click();
		}

		window.onload = (event) => {
			canvas = document.getElementById("canvas");
			grid = document.getElementById("grid");
			
			canvas.width = cell_width * canvas_magnification;
			canvas.height = cell_height * canvas_magnification;

			grid.width = cell_width * canvas_magnification;
			grid.height = cell_height * canvas_magnification;

			canvas_ctx = canvas.getContext("2d");
			grid_ctx = grid.getContext("2d");

			document.addEventListener("keydown", e => {
				onKeyDown(e);
			});

			initCanvas();
		}

	</script>
</html>
